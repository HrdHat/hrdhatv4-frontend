# Daily Log — 2025-06-10

---

## 10:04:35 — Backend Migration & Error Audit

- **Chapter:** Backend Schema & Error Handling
- **Summary:**
  - Applied migration to remove unique constraint from `form_number` in `form_instances`.
  - Audited backend and frontend for direct REST API calls; confirmed all data access uses the Supabase JS client.
  - Investigated 406 errors; determined they are caused by unauthenticated manual or external requests, not by application code. No code changes required.

## 12:12:20 — Frontend Form Header & User Logo

- **Chapter:** Frontend Form Rendering & Branding
- **Summary:**
  - Implemented modular form header with user logo fallback.
  - Ensured user-uploaded logo is used if available, otherwise default logo is shown.
  - Removed save, generate PDF, and last save UI from the top as per requirements.

## 13:19:08 — Drawer Logic for New Form Actions

- **Chapter:** Frontend Form Management & UX
- **Summary:**
  - Updated drawer logic so it only closes after user confirmation when starting any new form (including FLRA).
  - Ensured prompt appears if a form is open, and drawer only closes if the user confirms.
  - This prevents race conditions and unwanted re-renders when starting a new form from outside the drawer.

## 13:35:00 — Logo Loading Logic Fix & Root Cause Analysis

- **Chapter:** Frontend Form Rendering & Bug Resolution
- **Summary:**
  - Fixed missing stock logo on new form creation by correcting the logo loading logic in `FormService.getUserLogo()`.
  - Root cause: `getPublicUrl()` always returns a URL even for non-existent files, preventing fallback to default logo.
  - Solution: Added file existence check using `download()` before returning URL, enabling proper fallback to stock logo.
  - Result: New forms now display default logo correctly when user hasn't uploaded a custom logo.
